!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.cokescript=e()}}(function(){var e;return function n(e,r,t){function o(a,u){if(!r[a]){if(!e[a]){var l="function"==typeof require&&require;if(!u&&l)return l(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[a]={exports:{}};e[a][0].call(f.exports,function(n){var r=e[a][1][n];return o(r?r:n)},f,f.exports,n,e,r,t)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<t.length;a++)o(t[a]);return o}({1:[function(e,n){"use strict";function r(){return C[C.length-1]}function t(){return C.push({}),C[C.length-1]}function o(){C=[{}],P=1,M=[0],R=0}function i(){return M[M.length-1]}function a(e){return e>i()?"indent":e<i()?"dedent":e===i()?"samedent":void 0}function u(e){return function(n){var r=n.match(/^\n[ ]*/);if(r){var t=r[0].length-1;if(a(t)===e)return"dedent"==e?(M.pop(),""):("indent"==e&&M.push(t),r[0])}}}function l(e){if('"'===e.charAt(0))for(var n=1;e.charAt(n);){var r=e.charAt(n);if("\\"===r)n++;else if('"'===r)return e.slice(0,n+1);n++}}function c(e){return 0===e.indexOf("def(")?"def":0===e.indexOf("def ")?"def":0===e.indexOf("dom ")?"dom":void 0}function f(e){var n=e.match(/^\/\//)||e.match(/^#/);if(n)for(var r=n[0].length;e.charAt(r);){var t=e.charAt(r);if("\n"===t)return e.slice(0,r);r++}}function s(e){return{def:e.fd,fn:e.fn,params:e.p,block:e.b}}function d(e){return[e.fn,e.p,e.b]}function p(e){return[e.b]}function h(e){return[e.e,e.b]}function v(e){return[e.e,e.b,e.elif,e.el]}function m(e){return[e.k,e.v,e.a,e.b]}function y(e){for(var n="",r=0;e>r;r++)n+=" ";return n}function g(e){return y(e?2*(R+e):2*R)}function A(){return"__c"+F}function _(){return F++,"__c"+F}function E(){return F--,"__c"+F}function k(e,n){if(L[e.type])return L[e.type](e);if(void 0!==e.value)return e.value;var r,t="";if(!e.children)return"";for(r=0;r<e.children.length;r++)t+=k(e.children[r],n);return t}function b(e){var n="\nmodule.exports = {";e=e||Object.keys(r());for(var t=0;t<e.length;t++)n+="\n  "+e[t]+": "+e[t]+",";return n+"\n}"}function S(e){o();var n=D.parse(e+"\n");if(!n.complete)throw n.hint;var t={ast:n,code:k(n),ns:r()};return t}var R=0,P=1,C=[{}],M=[0],T=[{key:"comment",func:f},{key:"function_def",func:c,verbose:"function definition"},{key:"class",reg:/^class /},{key:"ret",reg:/^return/,verbose:"return"},{key:"if",reg:/^if /},{key:"tag",reg:/^<[a-zA-Z_$][0-9a-zA-Z_]{0,29}/},{key:"dom",reg:/^DOM:/},{key:"elseif",reg:/^elseif /},{key:"else",reg:/^else/},{key:"for_loop",reg:/^for /,verbose:"for loop"},{key:"in",reg:/^in /},{key:"name",reg:/^[a-zA-Z_$][0-9a-zA-Z_]{0,29}/},{key:"math_operators",reg:/^(\+\+|\-\-)/,verbose:"math operator"},{key:"binary_operators",reg:/^(\&\&|\|\||\&|\||<<|\>\>)/,verbose:"binary operator"},{key:"comparison",reg:/^(<=|>=|<|>|===|!=|==)/},{key:"assign",reg:/^(\+=|-=|=|:=)/},{key:"number",reg:/^[0-9]+\.?[0-9]*/},{key:"comma",reg:/^\,/},{key:"dot",reg:/^\./},{key:"colon",reg:/^\:/,verbose:":"},{key:"open_par",reg:/^\(/,verbose:"("},{key:"close_par",reg:/^\)/,verbose:")"},{key:"open_bra",reg:/^\[/,verbose:"["},{key:"close_bra",reg:/^\]/,verbose:"]"},{key:"open_curly",reg:/^\{/,verbose:"{"},{key:"close_curly",reg:/^\}/,verbose:"}"},{key:"math",reg:/^[-|\+|\*|/|%]/},{key:"samedent",func:u("samedent"),verbose:"same indentation"},{key:"dedent",func:u("dedent")},{key:"indent",func:u("indent")},{key:"W",reg:/^[ ]/,verbose:"single whitespace"},{key:"string",func:l}],O={START:{rules:["LINE* EOF"]},LINE:{rules:["STATEMENT samedent+","STATEMENT !dedent","comment? samedent"],verbose:"new line"},STATEMENT:{rules:["ASSIGN","IF","FOR","EXPR","RETURN","CLASS","TAG","DOM_ASSIGN"]},BLOCK:{rules:["indent LINE+ dedent"]},CLASS_METHODS:{rules:["samedent* f:FUNC_DEF samedent*"],hooks:[function(e){return e.f}]},CLASS:{rules:["class n:name open_par p:name close_par indent m:CLASS_METHODS+ dedent","class n:name indent m:CLASS_METHODS+ dedent"],hooks:[function(e){return{name:e.n,methods:e.m,parent:e.p}},function(e){return{name:e.n,methods:e.m}}]},FUNC_DEF_PARAMS:{rules:["p1:FUNC_DEF_PARAMS comma W p2:FUNC_DEF_PARAMS","p1:name assign e:EXPR","p1:name"],verbose:"function parameters"},LAMBDA:{rules:["function_def open_par p:FUNC_DEF_PARAMS? close_par W b:EXPR","function_def W fn:name open_par p:FUNC_DEF_PARAMS? close_par W b:EXPR"],hooks:[d,d]},FUNC_DEF:{rules:["fd:function_def open_par p:FUNC_DEF_PARAMS? close_par b:BLOCK","fd:function_def W fn:name open_par p:FUNC_DEF_PARAMS? close_par b:BLOCK"],hooks:[s,s],verbose:"function definition"},ELSE_IF:{rules:["samedent elseif e:EXPR b:BLOCK"],hooks:[h]},ELSE:{rules:["samedent else b:BLOCK"],hooks:[p]},IF:{rules:["if e:EXPR b:BLOCK elif:ELSE_IF* el:ELSE?"],hooks:[v]},MATH:{rules:["e1:EXPR W op:math W e2:EXPR"]},PATH:{rules:["PATH dot name","PATH open_bra number close_bra","name"]},ASSIGN:{rules:["left:EXPR W op:assign W right:EXPR"],hooks:[function(e){return{left:e.left,op:e.op,right:e.right}}]},FUNC_CALL_PARAMS:{rules:["FUNC_CALL_PARAMS comma W EXPR","EXPR"]},FUNC_CALL:{rules:["name open_par FUNC_CALL_PARAMS? close_par"]},FOR:{rules:["for_loop k:name comma W v:name W in a:name b:BLOCK","for_loop v:name W in a:name b:BLOCK"],hooks:[m,m]},COMMA_SEPARATED_EXPR:{rules:["EXPR comma SPACE* COMMA_SEPARATED_EXPR","EXPR"]},ARRAY:{rules:["open_bra SPACE* c:COMMA_SEPARATED_EXPR? SPACE* close_bra"]},MEMBERS:{rules:["name colon SPACE* EXPR comma SPACE* MEMBERS","name colon SPACE* EXPR"]},OBJECT:{rules:["open_curly SPACE* MEMBERS? SPACE* close_curly"]},TAG_PARAMS:{rules:["left:TAG_PARAMS W right:TAG_PARAMS","n:name assign e:EXPR","n:name"],hooks:[function(e){return{left:e.left,right:e.right}},function(e){return{n:e.n,e:e.e}},function(e){return{n:e.n}}],verbose:"tag parameters"},TAG:{rules:["tag:tag W? tp:TAG_PARAMS? b:BLOCK?"],hooks:[function(e){return{tag:e.tag,params:e.tp,block:e.b}}]},DOM_ASSIGN:{rules:["assign EXPR"]},SPACE:{rules:["W","indent","dedent","samedent"]},RETURN:{rules:["ret W EXPR","ret"]},RIGHT_EXPR:{rules:["math_operators","W binary_operators W EXPR","W comparison W EXPR","dot EXPR","open_bra EXPR close_bra"],verbose:"expression"},EXPR:{rules:["MATH","EXPR RIGHT_EXPR","FUNC_CALL","FUNC_DEF","LAMBDA","number","open_par EXPR close_par","string","name","PATH","ARRAY","OBJECT"],verbose:"expression"}},F=1,L={dedent:function(){return R=Math.max(0,R-1),""},indent:function(){return R+=1,"\n"+g()},samedent:function(){return"\n"+g()},DOM:function(e){var n=A(),r="",t="";e.children[2].children[0]&&(t=" "+e.children[2].children[0].value),e.children[2].children[1]&&(r=k(e.children[2].children[1]));var o="function"+t+"("+r+"){";return o+="\n"+g(1)+"var "+n+" = [];",o+=k(e.children[2].children[2]),o+="\n"+g(1)+"return "+n+";\n"+g()+"}"},DOM_ASSIGN:function(e){var n=A();return n+".push(String("+k(e.children[1])+"))"},TAG_PARAMS:function(e){return e.children.left?k(e.children.left)+", "+k(e.children.right):e.children.e?e.children.n.value+":"+k(e.children.e):e.children.n.value+": true"},TAG:function(e){var n="",r="",t=e.children.tag.value.substring(1);if(e.children.params)var r="{"+k(e.children.params)+"}";var o="[]";return e.children.block&&(o=_(),n+="var "+A()+" = [];",n+=k(e.children.block),E()),n+="\n"+g(1)+A()+'.push(h("'+t+'", '+r+", "+o+"))"},CLASS:function(e){var n,o=e.children.name.value,i=e.children.methods,a=e.children.parent,u="",l=null;for(n=0;n<i.length;n++){var c=i[n].children,f=c.children.fn.value;"constructor"===f?l=c:u+="\n"+g()+o+".prototype."+f+" = "+k(c)}var s=r();s[o]=!0,s=t();var d=l&&l.children.params;d=d?k(d):"";var p=l&&l.children.block,h="var "+o+" = function "+o+"("+d+") {";h+="\n"+g(1)+"if(!(this instanceof "+o+")){ return new "+o+"("+Object.keys(s).join(",")+");}";for(var v in s)s[v]!==!0&&void 0!==s[v]&&(h+="\n"+g(1)+"if("+v+" === undefined) {"+v+" = "+k(s[v])+"};");return p&&(h+=k(p)),h+=g()+"\n}",a&&(h+="\n"+g()+o+".prototype = Object.create("+a.value+".prototype);",h+="\n"+g()+o+".prototype.constructor = "+o),C.pop(),h+u},FUNC_DEF:function(e){var n="",o=r();e.children.fn&&(n=e.children.fn.value,o[n]=!0),o=t();var i="function "+n+"(";e.children.params&&(i+=k(e.children.params)),i+=") {";for(var a in o)o[a]!==!0&&void 0!==o[a]&&(i+="\n"+g(1)+"if("+a+" === undefined) {"+a+" = "+k(o[a])+"};");return"dom"===e.children.def.value&&(i+="\n"+g(1)+"var "+A()+" = [];"),e.children.block&&(i+=k(e.children.block)),C.pop(),"dom"===e.children.def.value&&(i+="\n"+g(1)+"return "+A()+";"),i+"\n"+g()+"}"},FUNC_DEF_PARAMS:function(e){var n,t="",o=r();for("name"===e.children[0].type&&(o[e.children[0].value]=!0,e.children[1]&&"assign"===e.children[1].type&&(o[e.children[0].value]=e.children[2])),n=0;n<e.children.length;n++){var i=e.children[n];("name"===i.type||"FUNC_DEF_PARAMS"===i.type||"comma"===i.type||"window"===i.type)&&(t+=k(e.children[n]))}return t},LAMBDA:function(e){var n="",r=t();e.children[0]&&(n=e.children[0].value);var o="function "+n+"(";return e.children[1]&&(o+=k(e.children[1],r)),o+=") { return ",e.children[2]&&(o+=k(e.children[2],r)),C.pop(),o+"; }"},ASSIGN:function(e){var n="",t=e.children.op.value,o=r();if("name"===e.children.left.children[0].type){var i=e.children.left.children[0];void 0===o[i.value]&&(":="==t?t="=":n="var ",o[i.value]=!0)}return n+k(e.children.left)+" "+t+" "+k(e.children.right)},STATEMENT:function(e){return k(e.children[0])+";"},IF:function(e){var n="";if(n="if("+k(e.children[0])+"){"+k(e.children[1])+"\n"+g()+"}",e.children[2])if(Array.isArray(e.children[2]))for(var r=0;r<e.children[2].length;r++)n+=k(e.children[2][r]);else n+=k(e.children[2]);return e.children[3]&&(n+=k(e.children[3])),n},FOR:function(e){var n="_index"+P,r="_keys"+P;P++;var t=!1;e.children[0]&&(t=e.children[0].value);var o="var "+r+" = Object.keys("+e.children[2].value+");\n";return o+=g()+"for(var "+n+" = 0; "+n+" < "+r+".length; "+n+"++ ) {\n",t&&(o+=g(1)+"var "+t+" = "+r+"["+n+"];\n"),o+=g(1)+"var "+e.children[1].value+" = "+e.children[2].value+"["+r+"["+n+"]];",o+=k(e.children[3])+"\n"+g()+"}"},ELSE_IF:function(e){return" else if("+k(e.children[0])+") {"+k(e.children[1])+"\n"+g()+"}"},ELSE:function(e){return" else {"+k(e.children[0])+"\n"+g()+"}"},string:function(e){var n=e.value;return n=n.replace(/\n/g,"\\n"),n.indexOf("{")>-1&&n.indexOf("}")>-1&&(n=n.split(/{/).map(function(e){var n=e.split(/}/);return n.length>1?'" + '+n[0]+' + "'+n[1]:e}).join("")),n},comment:function(e){return e.value.replace(/^#/g,"//")}},N=e("epegjs"),D=N.compileGrammar(O,T);n.exports={grammar:D,grammarDef:O,tokenDef:T,generateModule:S,generateCode:k,generateExports:b}},{epegjs:2}],2:[function(n,r,t){(function(o){!function(n){if("object"==typeof t&&"undefined"!=typeof r)r.exports=n();else if("function"==typeof e&&e.amd)e([],n);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof o?i=o:"undefined"!=typeof self&&(i=self),i.EPEG=n()}}(function(){return function e(r,t,o){function i(u,l){if(!t[u]){if(!r[u]){var c="function"==typeof n&&n;if(!l&&c)return c(u,!0);if(a)return a(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var s=t[u]={exports:{}};r[u][0].call(s.exports,function(e){var n=r[u][1][e];return i(n?n:e)},s,s.exports,e,r,t,o)}return t[u].exports}for(var a="function"==typeof n&&n,u=0;u<o.length;u++)i(o[u]);return i}({1:[function(e,n){"use strict";function r(e,n){for(var r,t,o,i=n.tokenKeys,a=n.tokenMap,u=[],l=e.length,c=e,f=null,s=0;l>s;){for(r=null,t=0;t<i.length;t++){o=i[t];var d,p=a[o];if(p.func){if(d=p.func(e),void 0!==d){r=d;break}}else{if(!p.reg)throw"Invalid token "+o+" without a reg or fund property";if(d=e.match(p.reg),null!==d){r=d[0];break}}}if(null===r){f&&(f.pointer+=f.value.length);var v=h(c,u,u.length-1,"Tokenizer error","No matching token found");throw f&&(v+="\nBefore token of type "+f.type+": "+f.value),v}f={type:o,value:r,pointer:s},u.push(f),s+=r.length,e=e.substr(r.length)}return u.push({type:"EOF",value:""}),u}function t(e,n){var r={type:e.type,value:e.value,repeat:n.repeat};return n.name&&(r.name=n.name),r}function o(e){var n={},r=0;return e.map(function(e){e.name&&("*"==e.repeat||"+"==e.repeat?(n[e.name]||(n[e.name]=[]),n[e.name].push(e)):n[e.name]=e),n["$"+r]=e,r++}),n}function i(e,n,r,t,i){for(var a,u,l=!1,f=e[n.key].hooks[n.index];;){if(a=t,u=c(e,n,r,a),u===!1||u.sp<=i.sp)return l;f&&!u.hooked&&(u.children=f(o(u.children)),u.hooked=!0),u.hooked=!0,i.children=u.children,i.sp=u.sp,i.start=u.start,i.hooked=u.hooked,l=u}return l}function a(e,n,r,t){for(var o=n.key+";"+t+";"+n.index,i=g.length-1;i>=0;){if(g[i][0]==o)return!1;i-=1}var a=A[n.key+";"+t];if(void 0!==a)return a;g.push([o,n]);var u=c(e,n,r,t);return g.pop(),u}function u(e,n){return"*"===e.repeat||"?"===e.repeat?!0:"+"===e.repeat&&n.children.length&&n.children[n.children.length-1].type==e.type?!0:!1}function l(e){return"*"===e.repeat||"+"===e.repeat}function c(e,n,r,c){for(var f,s,d=c,p=0,h={type:n.key,children:[],start:c,name:n.name},v=n.tokens[p],m=r[d];v&&m;){if(e[v.type]){var y=e[v.type].rules,g=e[v.type].hooks;s=!1;var k=A[v.type+";"+d];if(k&&(s=k),!s)for(f=0;f<y.length;f++){var b=y[f],S=g&&g[f];if(s=a(e,b,r,d)){if(S&&!s.hooked&&(s.children=S(o(s.children))),s.hooked=!0,A[b.key+";"+d]=s,v.repeat===!1){var R=i(e,n,r,d,s);if(R!==!1)return R}break}}if(s)d=s.sp,h.children.push({type:v.type,children:s.children,sp:s.sp,name:v.name,repeat:v.repeat}),l(v)||p++;else{if(!u(v,h))return!1;p++}}else if(m.type===v.type)v.nonCapturing||(h.children.push(t(m,v)),d++),l(v)||p++;else{if(!u(v,h))return!1;p++}if(E===d&&_.candidates.push([n,n.tokens[p]]),d>E&&(_={sp:d,candidates:[[n,n.tokens[p]]]},E=d),v=n.tokens[p],m=r[d],void 0===v)return h.sp=d,h.rp=p,h;if(void 0===m)return u(v,h)?(h.sp=d,h.rp=p,h):!1}return!1}function f(e,n){return e.split(n).map(function(e){return e.trim()})}function s(e){var n="!"===e.charAt(0);n&&(e=e.substr(1));var r=e.charAt(e.length-1);"*"===r||"?"===r||"+"===r?e=e.substr(0,e.length-1):r=!1;var t,o=e.split(":");if(t=2===o.length?{type:o[1],name:o[0]}:{type:e},t.repeat=r,("*"===r||"+"===r)&&n)throw"Impossible to have non capturing token that repeats";return n&&(t.nonCapturing=n),t}function d(e,n){var r,t,o,i=Object.keys(e),a={};a.tokenDef=n,a.tokenKeys=[],a.tokenMap={},n.map(function(e){a.tokenMap[e.key]=e,a.tokenKeys.push(e.key)});var u=i.concat(a.tokenKeys);for(r=0;r<i.length;r++){var l=e[i[r]],c=i[r],d=l.rules,p=[];for(t=0;t<d.length;t++){var h=f(d[t]," ");if(o=0,h=h.map(function(e){var n=s(e);if(-1===u.indexOf(n.type)&&"EOF"!==n.type)throw"Invalid token type used in the grammar: "+n.type;if("*"===n.repeat&&(o+=1),n.nonCapturing&&h[h.length-1]!=e)throw"Non capturing token has to be the last one in the rule: "+n.type;return n}),o===h.length)throw"Rule "+d[t]+" only has * tokens.";p.push({key:c,index:t,tokens:h})}a[c]={rules:p,hooks:l.hooks||[],verbose:l.verbose}}return a.parse=function(e){return y(e,a)},a}function p(e){for(var n="",r=0;e>r;r++)n+=" ";return n}function h(e,n,r,t,o){var i,a=n[r],u=a.pointer||0,l=e.split("\n"),c=0,f=0;for(i=0;i<l.length&&(c+=l[i].length+1,!(c>=u));i++)f+=l[i].length+1;var s=Math.max(0,i),d=t+" at line "+(s+1)+" char "+(u-f)+": ",h="\n"+p(u-f+(s+": ").length);return void 0!==l[s-1]&&(d=d+"\n"+s+": "+l[s-1]),d=d+"\n"+(s+1)+": "+l[s]+h,d=d+"^-- "+o,void 0!==l[s+1]&&(d=d+"\n"+(s+2)+": "+l[s+1]),d}function v(e,n){var r=e.tokenMap[n];return r&&r.verbose?r.verbose:e[n]&&e[n].verbose?e[n].verbose:n}function m(e,n,r,t){if(!r||!r.candidates[0])return"Complete failure to parse";var o=r.candidates[0][0],i=[];r.candidates.map(function(e){if(e[1]){var n=v(t,e[1].type);-1===i.indexOf(n)&&i.push(n)}});var a=i.join(" or "),u=h(e,n,r.sp,"Parser error","Rule "+v(t,o.key));u=u+"\nExpect "+a;var l=n[r.sp]||{type:"EOF"};return u=u+"\nBut got "+v(t,l.type)+" instead"}function y(e,n){var t,o,i,u={type:"START",sp:0,complete:!1};for(i=r(e,n),_={sp:0,candidates:[]},E=0,t=0;t<n.START.rules.length;t++)g=[],A={},o=a(n,n.START.rules[t],i,0),o&&o.sp>u.sp&&(u={type:"START",children:o.children,sp:o.sp,complete:o.sp===i.length,inputLength:i.length});return u.bestParse=_,_&&!u.complete&&(u.hint=m(e,i,_,n)),u}var g=[],A={},_=null,E=0;n.exports={parse:y,stack:g,compileGrammar:d,tokenize:r,memoization:A}},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});