!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.cokescript=e()}}(function(){var e;return function n(e,r,t){function o(a,u){if(!r[a]){if(!e[a]){var l="function"==typeof require&&require;if(!u&&l)return l(a,!0);if(i)return i(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var s=r[a]={exports:{}};e[a][0].call(s.exports,function(n){var r=e[a][1][n];return o(r?r:n)},s,s.exports,n,e,r,t)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<t.length;a++)o(t[a]);return o}({1:[function(e,n){"use strict";function r(){A=[{}],k=1,_=[0],g=0}function t(){return _[_.length-1]}function o(e){return e>t()?"indent":e<t()?"dedent":e===t()?"samedent":void 0}function i(e){return function(n){var r=(n.match(/^\n[ ]*\n/),n.match(/^\n[ ]*/));if(r){var t=r[0].length-1;if(o(t)===e)return"dedent"==e?(_.pop(),""):("indent"==e&&_.push(t),r[0])}}}function a(e){if('"'===e.charAt(0))for(var n=1;e.charAt(n);){var r=e.charAt(n);if("\\"===r)n++;else if('"'===r)return e.slice(0,n+1);n++}}function u(e){return 0===e.indexOf("def(")?"def":0===e.indexOf("def ")?"def":void 0}function l(e){if(0===e.indexOf("//"))for(var n=2;e.charAt(n);){var r=e.charAt(n);if("\n"===r)return e.slice(0,n);n++}}function f(e){return[e.fn,e.p,e.b]}function s(e){return[e.fn,e.p,e.b]}function c(e){return[e.b]}function p(e){return[e.e,e.b]}function d(e){return[e.e,e.b,e.elif,e.el]}function h(e){return[e.k,e.v,e.a,e.b]}function v(e){for(var n="",r=0;e>r;r++)n+=" ";return n}function m(e){return v(e?2*(g+e):2*g)}function y(e,n){if(S[e.type])return S[e.type](e);if(void 0!==e.value)return e.value;var r,t="";if(!e.children)return"";for(r=0;r<e.children.length;r++)t+=y(e.children[r],n);return t}function E(e){r();var n=C.parse(e+"\n");if(!n.complete)throw n.hint;return{ast:n,code:y(n)}}var g=0,k=1,A=[{}],_=[0],b=[{key:"comment",func:l},{key:"function_def",func:u,verbose:"function definition"},{key:"class",reg:/^class /},{key:"ret",reg:/^return/,verbose:"return"},{key:"if",reg:/^if /},{key:"elseif",reg:/^elseif /},{key:"else",reg:/^else/},{key:"for_loop",reg:/^for /,verbose:"for loop"},{key:"in",reg:/^in /},{key:"name",reg:/^[a-zA-Z_$][0-9a-zA-Z_]{0,29}/},{key:"math_operators",reg:/^(\+\+|\-\-)/,verbose:"math operator"},{key:"binary_operators",reg:/^(\&\&|\|\||\&|\||<<|\>\>)/,verbose:"binary operator"},{key:"comparison",reg:/^(<=|>=|<|>|===|!=|==)/},{key:"assign",reg:/^(\+=|-=|=|:=)/},{key:"number",reg:/^[0-9]+\.?[0-9]*/},{key:"comma",reg:/^\,/},{key:"dot",reg:/^\./},{key:"colon",reg:/^\:/,verbose:":"},{key:"open_par",reg:/^\(/,verbose:"("},{key:"close_par",reg:/^\)/,verbose:")"},{key:"open_bra",reg:/^\[/,verbose:"["},{key:"close_bra",reg:/^\]/,verbose:"]"},{key:"open_curly",reg:/^\{/,verbose:"{"},{key:"close_curly",reg:/^\}/,verbose:"}"},{key:"math",reg:/^[-|\+|\*|/|%]/},{key:"samedent",func:i("samedent"),verbose:"same indentation"},{key:"dedent",func:i("dedent")},{key:"indent",func:i("indent")},{key:"W",reg:/^[ ]/,verbose:"single whitespace"},{key:"string",func:a}],R={START:{rules:["LINE* EOF"]},LINE:{rules:["STATEMENT samedent+","STATEMENT !dedent","comment? samedent"],verbose:"new line"},STATEMENT:{rules:["ASSIGN","IF","FOR","EXPR","RETURN","CLASS"]},BLOCK:{rules:["indent LINE+ dedent"]},CLASS_METHODS:{rules:["samedent* f:FUNC_DEF samedent*"],hooks:[function(e){return e.f}]},CLASS:{rules:["class n:name open_par p:name close_par indent m:CLASS_METHODS* dedent","class n:name indent m:CLASS_METHODS* dedent"],hooks:[function(e){return{name:e.n,methods:e.m,parent:e.p}},function(e){return{name:e.n,methods:e.m}}]},FUNC_DEF_PARAMS:{rules:["p1:FUNC_DEF_PARAMS comma W p2:FUNC_DEF_PARAMS","p1:name assign e:EXPR","p1:name"],verbose:"function parameters"},LAMBDA:{rules:["function_def open_par p:FUNC_DEF_PARAMS? close_par W b:EXPR","function_def W fn:name open_par p:FUNC_DEF_PARAMS? close_par W b:EXPR"],hooks:[s,s]},FUNC_DEF:{rules:["function_def open_par p:FUNC_DEF_PARAMS? close_par b:BLOCK","function_def W fn:name open_par p:FUNC_DEF_PARAMS? close_par b:BLOCK"],hooks:[f,f],verbose:"function definition"},ELSE_IF:{rules:["samedent elseif e:EXPR b:BLOCK"],hooks:[p]},ELSE:{rules:["samedent else b:BLOCK"],hooks:[c]},IF:{rules:["if e:EXPR b:BLOCK elif:ELSE_IF* el:ELSE?"],hooks:[d]},MATH:{rules:["e1:EXPR W op:math W e2:EXPR"]},PATH:{rules:["PATH dot name","PATH open_bra number close_bra","name"]},ASSIGN:{rules:["left:EXPR W op:assign W right:EXPR"],hooks:[function(e){return{left:e.left,op:e.op,right:e.right}}]},FUNC_CALL_PARAMS:{rules:["FUNC_CALL_PARAMS comma W EXPR","EXPR"]},FUNC_CALL:{rules:["name open_par FUNC_CALL_PARAMS? close_par"]},FOR:{rules:["for_loop k:name comma W v:name W in a:name b:BLOCK","for_loop v:name W in a:name b:BLOCK"],hooks:[h,h]},COMMA_SEPARATED_EXPR:{rules:["EXPR comma SPACE* COMMA_SEPARATED_EXPR","EXPR"]},ARRAY:{rules:["open_bra SPACE* c:COMMA_SEPARATED_EXPR? SPACE* close_bra dedent?"]},MEMBERS:{rules:["name colon SPACE* EXPR comma SPACE* MEMBERS","name colon SPACE* EXPR"]},OBJECT:{rules:["open_curly SPACE* MEMBERS? SPACE* close_curly dedent?"]},SPACE:{rules:["W","indent","dedent","samedent"]},RETURN:{rules:["ret W EXPR","ret"]},RIGHT_EXPR:{rules:["math_operators","W binary_operators W EXPR","W comparison W EXPR","dot EXPR","open_bra EXPR close_bra"],verbose:"expression"},EXPR:{rules:["MATH","EXPR RIGHT_EXPR","FUNC_CALL","FUNC_DEF","LAMBDA","number","open_par EXPR close_par","string","name","PATH","ARRAY","OBJECT"],verbose:"expression"}},S={dedent:function(){return g=Math.max(0,g-1),""},indent:function(){return g+=1,"\n"+m()},samedent:function(){return"\n"+m()},CLASS:function(e){var n,r=e.children.name.value,t=e.children.methods,o=e.children.parent,i="",a=null;for(n=0;n<t.length;n++){var u=t[n].children,l=u.children[0].value;"constructor"===l?a=u:i+="\n"+m()+r+".prototype."+l+" = "+y(u)}A.push({});var f=A[A.length-1],s=a&&a.children[1];s=s?y(s):"";var c=a&&a.children[2],p="var "+r+" = function "+r+"("+s+") {";p+="\n"+m(1)+"if(!(this instanceof "+r+")){ return new "+r+"("+Object.keys(f).join(",")+");}";for(var d in f)f[d]!==!0&&void 0!==f[d]&&(p+="\n"+m(1)+"if("+d+" === undefined) {"+d+"="+y(f[d])+"};");return c&&(p+=y(c)),p+=m()+"\n}",o&&(p+="\n"+m()+r+".prototype = Object.create("+o.value+".prototype);",p+="\n"+m()+r+".prototype.constructor = "+r),A.pop(),p+i},FUNC_DEF:function(e){var n="";A.push({});var r=A[A.length-1];e.children[0]&&(n=e.children[0].value);var t="function "+n+"(";e.children[1]&&(t+=y(e.children[1])),t+=") {";for(var o in r)r[o]!==!0&&void 0!==r[o]&&(t+="\n"+m(1)+"if("+o+" === undefined) {"+o+"="+y(r[o])+"};");return e.children[2]&&(t+=y(e.children[2])),A.pop(),t+"\n"+m()+"}"},FUNC_DEF_PARAMS:function(e){var n,r="",t=A[A.length-1];for("name"===e.children[0].type&&(t[e.children[0].value]=!0,e.children[1]&&"assign"===e.children[1].type&&(t[e.children[0].value]=e.children[2])),n=0;n<e.children.length;n++){var o=e.children[n];("name"===o.type||"FUNC_DEF_PARAMS"===o.type||"comma"===o.type||"window"===o.type)&&(r+=y(e.children[n]))}return r},LAMBDA:function(e){var n="";A.push({});var r=A[A.length-1];e.children[0]&&(n=e.children[0].value);var t="function "+n+"(";return e.children[1]&&(t+=y(e.children[1],r)),t+=") { return ",e.children[2]&&(t+=y(e.children[2],r)),A.pop(),t+"; }"},ASSIGN:function(e){var n="",r=e.children.op.value,t=A[A.length-1];if("name"===e.children.left.children[0].type){var o=e.children.left.children[0];void 0===t[o.value]&&(":="==r?r="=":n="var ",t[o.value]=!0)}return n+y(e.children.left)+r+y(e.children.right)},STATEMENT:function(e){return y(e.children[0])+";"},IF:function(e){var n="";if(n="if("+y(e.children[0])+"){"+y(e.children[1])+"\n"+m()+"}",e.children[2])if(Array.isArray(e.children[2]))for(var r=0;r<e.children[2].length;r++)n+=y(e.children[2][r]);else n+=y(e.children[2]);return e.children[3]&&(n+=y(e.children[3])),n},FOR:function(e){var n="_index"+k,r="_keys"+k;k++;var t=!1;e.children[0]&&(t=e.children[0].value);var o="var "+r+" = Object.keys("+e.children[2].value+");\n";return o+=m()+"for(var "+n+"=0; "+n+" < "+r+".length; "+n+"++ ) {\n",t&&(o+=m(1)+"var "+t+" = "+r+"["+n+"];\n"),o+=m(1)+"var "+e.children[1].value+" = "+e.children[2].value+"["+r+"["+n+"]];",o+=y(e.children[3])+"\n"+m()+"}"},ELSE_IF:function(e){return" else if("+y(e.children[0])+") {"+y(e.children[1])+"\n"+m()+"}"},ELSE:function(e){return" else {"+y(e.children[0])+"\n"+m()+"}"},string:function(e){return e.value.replace(/\n/g,"\\\n")}},P=e("epegjs"),C=P.compileGrammar(R,b);n.exports={grammar:C,grammarDef:R,tokenDef:b,generateModule:E,generateCode:y}},{epegjs:2}],2:[function(n,r,t){(function(o){!function(n){if("object"==typeof t&&"undefined"!=typeof r)r.exports=n();else if("function"==typeof e&&e.amd)e([],n);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof o?i=o:"undefined"!=typeof self&&(i=self),i.EPEG=n()}}(function(){return function e(r,t,o){function i(u,l){if(!t[u]){if(!r[u]){var f="function"==typeof n&&n;if(!l&&f)return f(u,!0);if(a)return a(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var c=t[u]={exports:{}};r[u][0].call(c.exports,function(e){var n=r[u][1][e];return i(n?n:e)},c,c.exports,e,r,t,o)}return t[u].exports}for(var a="function"==typeof n&&n,u=0;u<o.length;u++)i(o[u]);return i}({1:[function(e,n){"use strict";function r(e,n){for(var r,t,o,i=n.tokenKeys,a=n.tokenMap,u=[],l=e.length,f=e,s=null,c=0;l>c;){for(r=null,t=0;t<i.length;t++){o=i[t];var p,d=a[o];if(d.func){if(p=d.func(e),void 0!==p){r=p;break}}else{if(!d.reg)throw"Invalid token "+o+" without a reg or fund property";if(p=e.match(d.reg),null!==p){r=p[0];break}}}if(null===r){s&&(s.pointer+=s.value.length);var v=h(f,u,u.length-1,"Tokenizer error","No matching token found");throw s&&(v+="\nBefore token of type "+s.type+": "+s.value),v}s={type:o,value:r,pointer:c},u.push(s),c+=r.length,e=e.substr(r.length)}return u.push({type:"EOF",value:""}),u}function t(e,n){var r={type:e.type,value:e.value,repeat:n.repeat};return n.name&&(r.name=n.name),r}function o(e){var n={},r=0;return e.map(function(e){e.name&&("*"==e.repeat?(n[e.name]||(n[e.name]=[]),n[e.name].push(e)):n[e.name]=e),n["$"+r]=e,r++}),n}function i(e,n,r,t,i){for(var a,u,l=!1,s=e[n.key].hooks[n.index];;){if(a=t,u=f(e,n,r,a),u===!1||u.sp<=i.sp)return l;s&&!u.hooked&&(u.children=s(o(u.children)),u.hooked=!0),u.hooked=!0,i.children=u.children,i.sp=u.sp,i.start=u.start,i.hooked=u.hooked,l=u}return l}function a(e,n,r,t){for(var o=n.key+";"+t+";"+n.index,i=E.length-1;i>=0;){if(E[i][0]==o)return!1;i-=1}var a=g[n.key+";"+t];if(void 0!==a)return a;E.push([o,n]);var u=f(e,n,r,t);return E.pop(),u}function u(e,n){return"*"===e.repeat||"?"===e.repeat?!0:"+"===e.repeat&&n.children.length&&n.children[n.children.length-1].type==e.type?!0:!1}function l(e){return"*"===e.repeat||"+"===e.repeat}function f(e,n,r,f){for(var s,c,p=f,d=0,h={type:n.key,children:[],start:f,name:n.name},v=n.tokens[d],m=r[p];v&&m;){if(e[v.type]){var y=e[v.type].rules,E=e[v.type].hooks;c=!1;var _=g[v.type+";"+p];if(_&&(c=_),!c)for(s=0;s<y.length;s++){var b=y[s],R=E&&E[s];if(c=a(e,b,r,p)){if(R&&!c.hooked&&(c.children=R(o(c.children))),c.hooked=!0,g[b.key+";"+p]=c,v.repeat===!1){var S=i(e,n,r,p,c);if(S!==!1)return S}break}}if(c)p=c.sp,h.children.push({type:v.type,children:c.children,sp:c.sp,name:v.name,repeat:v.repeat}),l(v)||d++;else{if(!u(v,h))return!1;d++}}else if(m.type===v.type)v.nonCapturing||(h.children.push(t(m,v)),p++),l(v)||d++;else{if(!u(v,h))return!1;d++}if(A===p&&k.candidates.push([n,n.tokens[d]]),p>A&&(k={sp:p,candidates:[[n,n.tokens[d]]]},A=p),v=n.tokens[d],m=r[p],void 0===v)return h.sp=p,h.rp=d,h;if(void 0===m)return u(v,h)?(h.sp=p,h.rp=d,h):!1}return!1}function s(e,n){return e.split(n).map(function(e){return e.trim()})}function c(e){var n="!"===e.charAt(0);n&&(e=e.substr(1));var r=e.charAt(e.length-1);"*"===r||"?"===r||"+"===r?e=e.substr(0,e.length-1):r=!1;var t,o=e.split(":");if(t=2===o.length?{type:o[1],name:o[0]}:{type:e},t.repeat=r,("*"===r||"+"===r)&&n)throw"Impossible to have non capturing token that repeats";return n&&(t.nonCapturing=n),t}function p(e,n){var r,t,o,i=Object.keys(e),a={};a.tokenDef=n,a.tokenKeys=[],a.tokenMap={},n.map(function(e){a.tokenMap[e.key]=e,a.tokenKeys.push(e.key)});var u=i.concat(a.tokenKeys);for(r=0;r<i.length;r++){var l=e[i[r]],f=i[r],p=l.rules,d=[];for(t=0;t<p.length;t++){var h=s(p[t]," ");if(o=0,h=h.map(function(e){var n=c(e);if(-1===u.indexOf(n.type)&&"EOF"!==n.type)throw"Invalid token type used in the grammar: "+n.type;if("*"===n.repeat&&(o+=1),n.nonCapturing&&h[h.length-1]!=e)throw"Non capturing token has to be the last one in the rule: "+n.type;return n}),o===h.length)throw"Rule "+p[t]+" only has * tokens.";d.push({key:f,index:t,tokens:h})}a[f]={rules:d,hooks:l.hooks||[],verbose:l.verbose}}return a.parse=function(e){return y(e,a)},a}function d(e){for(var n="",r=0;e>r;r++)n+=" ";return n}function h(e,n,r,t,o){var i,a=n[r],u=a.pointer||0,l=e.split("\n"),f=0,s=0;for(i=0;i<l.length&&(f+=l[i].length+1,!(f>=u));i++)s+=l[i].length+1;var c=Math.max(0,i),p=t+" at line "+(c+1)+" char "+(u-s)+": ",h="\n"+d(u-s+(c+": ").length);return void 0!==l[c-1]&&(p=p+"\n"+c+": "+l[c-1]),p=p+"\n"+(c+1)+": "+l[c]+h,p=p+"^-- "+o,void 0!==l[c+1]&&(p=p+"\n"+(c+2)+": "+l[c+1]),p}function v(e,n){var r=e.tokenMap[n];return r&&r.verbose?r.verbose:e[n]&&e[n].verbose?e[n].verbose:n}function m(e,n,r,t){if(!r||!r.candidates[0])return"Complete failure to parse";var o=r.candidates[0][0],i=[];r.candidates.map(function(e){if(e[1]){var n=v(t,e[1].type);-1===i.indexOf(n)&&i.push(n)}});var a=i.join(" or "),u=h(e,n,r.sp,"Parser error","Rule "+v(t,o.key));u=u+"\nExpect "+a;var l=n[r.sp]||{type:"EOF"};return u=u+"\nBut got "+v(t,l.type)+" instead"}function y(e,n){var t,o,i,u={type:"START",sp:0,complete:!1};for(i=r(e,n),k={sp:0,candidates:[]},A=0,t=0;t<n.START.rules.length;t++)E=[],g={},o=a(n,n.START.rules[t],i,0),o&&o.sp>u.sp&&(u={type:"START",children:o.children,sp:o.sp,complete:o.sp===i.length,inputLength:i.length});return u.bestParse=k,k&&!u.complete&&(u.hint=m(e,i,k,n)),u}var E=[],g={},k=null,A=0;n.exports={parse:y,stack:E,compileGrammar:p,tokenize:r,memoization:g}},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});