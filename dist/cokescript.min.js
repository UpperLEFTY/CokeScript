!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.cokescript=e()}}(function(){var e;return function n(e,r,t){function o(a,l){if(!r[a]){if(!e[a]){var c="function"==typeof require&&require;if(!l&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var s=r[a]={exports:{}};e[a][0].call(s.exports,function(n){var r=e[a][1][n];return o(r?r:n)},s,s.exports,n,e,r,t)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<t.length;a++)o(t[a]);return o}({1:[function(e,n){function r(){return O[O.length-1]}function t(e){return O[O.length-1].hasOwnProperty(e)}function o(){return O.push({}),O[O.length-1]}function i(){O=[{}],T=1,X=[0],C=0,M=0}function a(e,n){var r;return r=n[n.length-1],r&&"\\"===r.value?void 0:e.match(/^#{/)?"#{":void 0}function l(e,n){var r;if("VAR"===e.type)return n+" + "+l(e.children[1],n)+" + "+n;if(void 0!==e.value)return e.value;if(r="",!e.children)return"";for(var t=Object.keys(e.children),o=0;o<t.length;o++){var i=e.children[t[o]];r+=l(i,n)}return r}function c(){return X[X.length-1]}function u(e){return e>c()?"indent":e<c()?"dedent":e===c()?"samedent":void 0}function s(e){return function(n){var r,t,o;return r=n.match(/^\n[\s]*/),r&&(t=r[0].split("\n"),o=t[t.length-1].length,u(o)===e)?"dedent"===e?(X.pop(),""):("indent"===e&&X.push(o),r[0]):void 0}}function f(e){var n,r,t;if(n=e.charAt(0),'"'===n||"'"===n)for(r=1;e.charAt(r);){if(t=e.charAt(r),"\\"===t)r++;else if(t===n)return e.slice(0,r+1);r++}}function d(e){var n,r;if("/"===e.charAt(0))for(n=1;e.charAt(n);){if(r=e.charAt(n),"\\"===r)n++;else if("/"===r){for(n++;e.charAt(n)&&-1!=="igm".indexOf(e.charAt(n));)n++;return e.slice(0,n)}n++}}function h(e){return e.match(/^def[\(| |\n]/)?"def":0===e.indexOf("dom ")?"dom":void 0}function p(e){var n,r,t;if(n=e.match(/^#/))for(r=n[0].length;e.charAt(r);){if(t=e.charAt(r),"\n"===t)return e.slice(0,r);r++}}function v(e){return e}function E(e){var n,r;for(n="",r=0;e>r;)n+=" ",r++;return n}function m(e){return E(e?2*(C+e):2*C)}function A(){return L+"c"+I}function y(){return I++,L+"c"+I}function k(){return I--,L+"c"+I}function _(){var e,n;e=r(),n=[];for(var t=Object.keys(e),o=0;o<t.length;o++){var i=t[o],a=e[t[o]];"hoist"===a&&n.push(i)}return n.length?"var "+n.join(", ")+";":""}function g(e){var n;n=r(),n[e]="hoist"}function R(e){var n;if(x[e.type])return x[e.type](e);if(void 0!==e.value)return e.value;if(n="",!e.children)return"";for(var r=Object.keys(e.children),t=0;t<r.length;t++){var o=e.children[r[t]];n+=R(o)}return n}function b(e){var n;n="\nmodule.exports = {",e=e||Object.keys(r());for(var t=Object.keys(e),o=0;o<t.length;o++){var i=e[t[o]];n+="\n  "+i+" : "+i+","}return n+"\n}"}function P(e){var n,t;if(i(),n=j.parse(e+"\n"),!n.complete)throw new Error(n.hint);return t={ast:n,code:R(n),ns:r()}}var S,C,T,M,O,X,L,N,w,F,W,D,I,x,j;S=e("epegjs"),C=0,T=1,M=0,O=[{}],X=[0],L="__",N=[{key:"string",func:f},{key:"comment",func:p},{key:"function_def",func:h,verbose:"function"},{key:"class",reg:/^class /},{key:"ret",reg:/^return/,verbose:"return"},{key:"if",reg:/^if /},{key:"or",reg:/^or /},{key:"and",reg:/^and /},{key:"while",reg:/^while /},{key:"instanceof",reg:/^instanceof /},{key:"try",reg:/^try/},{key:"catch",reg:/^catch/},{key:"throw",reg:/^throw /},{key:"pazz",reg:/^pass/,verbose:"pass"},{key:"new",reg:/^new /},{key:"tag",reg:/^<[a-zA-Z][0-9a-zA-Z]{0,29}/},{key:">",reg:/^>/},{key:"elseif",reg:/^elseif /},{key:"else",reg:/^else/},{key:"for_loop",reg:/^for /,verbose:"for loop"},{key:"in",reg:/^in /},{key:"not",reg:/^not /,verbose:"not"},{key:"name",reg:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,29}/},{key:"regexp",func:d,verbose:"regular expression"},{key:"math_operators",reg:/^(\+\+|\-\-)/,verbose:"math operator"},{key:"binary_operators",reg:/^(\&\&|\|\||\&|\||<<|\>\>)/,verbose:"binary operator"},{key:"comparison",reg:/^(<=|>=|<|>|!=|==)/},{key:"assign",reg:/^(\+=|-=|=|:=)/},{key:"number",reg:/^[-]?[0-9]+\.?[0-9]*/},{key:"comma",reg:/^\,/},{key:"dot",reg:/^\./},{key:"colon",reg:/^\:/,verbose:":"},{key:"open_par",reg:/^\(/,verbose:"("},{key:"close_par",reg:/^\)/,verbose:")"},{key:"open_bra",reg:/^\[/,verbose:"["},{key:"close_bra",reg:/^\]/,verbose:"]"},{key:"open_curly",reg:/^\{/,verbose:"{"},{key:"close_curly",reg:/^\}/,verbose:"}"},{key:"math",reg:/^[-|\+|\*|\/|%]/},{key:"samedent",func:s("samedent"),verbose:"same indentation"},{key:"dedent",func:s("dedent")},{key:"indent",func:s("indent")},{key:"W",reg:/^[ ]/,verbose:"single whitespace"}],w=[{key:"start",func:a},{key:"end",reg:/^}/},{key:"name",reg:/^[a-zA-Z_$][0-9a-zA-Z_]{0,29}/},{key:"dot",reg:/^\./},{key:"char",reg:/^./}],F={START:{rules:["EL* EOF"]},EL:{rules:["VAR","char","name","start","end","dot"]},VAR:{rules:["start NAME end"]},NAME:{rules:["name dot NAME","name"]}},W=S.compileGrammar(F,w),D={START:{rules:["LINE* EOF"]},ELC:{rules:["W* comment"],verbose:"comment"},LINE:{rules:["STATEMENT ELC? samedent+","STATEMENT ELC? !dedent","ELC? samedent","ELC !dedent"],verbose:"new line"},BLOCK:{rules:["indent pazz dedent","indent LINE+ dedent"]},STATEMENT:{rules:["ASSIGN","EXPR","IF","WHILE","FOR","RETURN","CLASS","TAG","DOM_ASSIGN","TRY_CATCH","THROW"]},CLASS_METHODS:{rules:["samedent* f:FUNC_DEF samedent*"],hooks:[function(e){return e.f}]},CLASS:{rules:["class n:name open_par p:name close_par indent m:CLASS_METHODS+ dedent","class n:name indent m:CLASS_METHODS+ dedent"],hooks:[function(e){return{name:e.n,methods:e.m,parent:e.p}},function(e){return{name:e.n,methods:e.m}}]},FUNC_DEF_PARAMS:{rules:["p1:FUNC_DEF_PARAMS comma W p2:FUNC_DEF_PARAMS","p1:name assign e:EXPR","p1:name"],verbose:"def parameters"},LAMBDA:{rules:["fd:function_def open_par params:FUNC_DEF_PARAMS? close_par W block:EXPR","fd:function_def W fn:name open_par params:FUNC_DEF_PARAMS? close_par W block:EXPR","fd:function_def W block:EXPR"],hooks:[v,v,v]},FUNC_DEF:{rules:["fd:function_def open_par params:FUNC_DEF_PARAMS? close_par block:BLOCK","fd:function_def W fn:name open_par params:FUNC_DEF_PARAMS? close_par block:BLOCK","fd:function_def W fn:name block:BLOCK","fd:function_def block:BLOCK"],hooks:[v,v,v,v],verbose:"def definition"},ELSE_IF:{rules:["samedent elseif e:EXPR b:BLOCK"],hooks:[v]},ELSE:{rules:["samedent else b:BLOCK"],hooks:[v]},IF:{rules:["if e:EXPR b:BLOCK elif:ELSE_IF* el:ELSE?"],hooks:[v]},ELSE_EXPR:{rules:["W else W b:EXPR"],hooks:[v]},IF_EXPR:{rules:["e:EXPR W if test:EXPR el:ELSE_EXPR?"],hooks:[v]},WHILE:{rules:["while e:EXPR b:BLOCK"],hooks:[v]},MATH:{rules:["e1:EXPR W op:math W e2:EXPR"]},PATH:{rules:["PATH dot name","PATH open_bra number close_bra","name"]},ASSIGN:{rules:["left:EXPR W op:assign W right:EXPR","left:STRICT_COMMA_SEPARATED_EXPR W op:assign W right:STRICT_COMMA_SEPARATED_EXPR","left:STRICT_COMMA_SEPARATED_EXPR W op:assign W right:EXPR"],hooks:[v,v,v]},W_OR_SAMEDENT:{rules:["W","samedent"],verbose:"samedent or whitespace"},W_SAMEDENT_INDENT:{rules:["W","samedent","indent"],verbose:"indent or samedent or whitespace"},ANY_SPACE:{rules:["W","samedent","indent","dedent","comment"],verbose:"any space"},FUNC_CALL_PARAMS:{rules:["EXPR comma ANY_SPACE+ FUNC_CALL_PARAMS ANY_SPACE*","EXPR ANY_SPACE*"]},FUNC_CALL:{rules:["open_par FUNC_CALL_PARAMS? close_par"]},TYPE:{rules:["name colon"]},FOR:{rules:["for_loop k:name comma W v:name W in a:EXPR b:BLOCK","for_loop v:name W in a:EXPR b:BLOCK"],hooks:[v,v]},STRICT_COMMA_SEPARATED_EXPR:{rules:["e1:EXPR comma W e2:STRICT_COMMA_SEPARATED_EXPR","e1:EXPR comma W e2:EXPR"],hooks:[function(e){return[e.e1].concat(e.e2.children)},function(e){return[e.e1,e.e2]}]},COMMA_SEPARATED_EXPR:{rules:["EXPR comma ANY_SPACE+ COMMA_SEPARATED_EXPR ANY_SPACE*","EXPR ANY_SPACE*"]},ARRAY:{rules:["open_bra ANY_SPACE* c:COMMA_SEPARATED_EXPR? ANY_SPACE* close_bra"]},MEMBERS:{rules:["name colon W EXPR samedent? comma ANY_SPACE+ MEMBERS ANY_SPACE*","name colon W EXPR ANY_SPACE*"]},OBJECT:{rules:["open_curly indent? MEMBERS? close_curly"]},TAG_PARAMS:{rules:["left:TAG_PARAMS W right:TAG_PARAMS","n:name assign e:EXPR","n:name"],hooks:[v,v,v],verbose:"tag parameters"},TAG:{rules:["tag:tag W? params:TAG_PARAMS? end:>? block:BLOCK?"],hooks:[v]},DOM_ASSIGN:{rules:["assign EXPR"]},TRY_CATCH:{rules:["try b1:BLOCK samedent? catch open_par err:name? close_par b2:BLOCK"],hooks:[v]},THROW:{rules:["throw EXPR"]},RETURN:{rules:["ret W STRICT_COMMA_SEPARATED_EXPR","ret W EXPR","ret"]},RIGHT_EXPR:{rules:["math_operators","W binary_operators W EXPR","W or EXPR","W and EXPR","W comparison W EXPR","W > W EXPR","dot EXPR","W instanceof EXPR","open_bra EXPR close_bra","FUNC_CALL"],verbose:"expression"},EXPR:{rules:["IF_EXPR","MATH","OBJECT","FUNC_DEF","EXPR RIGHT_EXPR","name","number","LAMBDA","string","regexp","open_par EXPR close_par","new EXPR","not EXPR","ARRAY"],verbose:"expression"}},I=1,x={START:function(e){var n,r;n="";for(var t=Object.keys(e.children),o=0;o<t.length;o++){var i=e.children[t[o]];n+=R(i)}return r=_(),r?_()+"\n"+n:n},dedent:function(){return C=Math.max(0,C-1),""},indent:function(){return C+=1,"\n"+m()},samedent:function(e){var n,r,t;for(n=e.value.split("\n").length-1,r=0,t="";n>r;)t+="\n"+m(),r++;return t},DOM_ASSIGN:function(e){var n,r,t;return n=A(),r=R(e.children[1]),g(A()),g(""+L+"tmp"),t=""+L+"tmp = "+r+"; "+L+"tmp instanceof Array ? ("+n+" = "+n+".concat("+L+"tmp)) : "+n+".push(String("+L+"tmp))"},TAG_PARAMS:function(e){var n;return e.children.left?R(e.children.left)+", "+R(e.children.right):(n=e.children.n.value,e.children.e?n+": "+R(e.children.e):n+": true")},TAG:function(e){var n,t,o,i,a;return n="",t="{",o=e.children.tag.value.substring(1),e.children.params&&(t+=R(e.children.params)),t+="}",i="[]",a=r(),e.children.block&&(i=y(),n+=A()+" = [];",g(A()),n+=R(e.children.block),k()),n+="\n"+m()+A()+'.push(virtualDom.h("'+o+'", {attributes: '+t+"}, "+i+"))"},CLASS:function(e){var n,r,t,i,a,l,c,u,s,f,d;n=e.children.name.value,r=e.children.methods,t=e.children.parent,i="",a=null;for(var h=Object.keys(r),p=0;p<h.length;p++){var v=r[h[p]];l=v.children,c=l.children.fn.value,"constructor"===c?a=l:i+="\n"+m()+n+".prototype."+c+" = "+R(l)}g(n),u=o(),s=a&&a.children.params,s=s?R(s):"",f=a&&a.children.block,d=""+n+" = function "+n+" ( "+s+" ) {",d+="\n"+m(1)+"if(!(this instanceof "+n+")){ return new "+n+"("+Object.keys(u).join(",")+")}";for(var E=Object.keys(u),A=0;A<E.length;A++){var y=E[A],k=u[E[A]];k!==!0&&void 0!==k&&(d+="\n"+m(1)+"if("+y+" === undefined) {"+y+" = "+R(k)+"}")}return f&&(d+=R(f)),d+=m()+"\n}",t&&(d+="\n"+m()+n+".prototype = Object.create("+t.value+".prototype)",d+="\n"+m()+n+".prototype.constructor = "+n),O.pop(),d+i},LAMBDA:function(e){var n,r,t,i;n="",r=o(),e.children.fn&&(n=e.children.fn.value,r[n]=!0),t="function "+n+"(",e.children.params&&(t+=R(e.children.params,r)),t+=") {";for(var a=Object.keys(r),l=0;l<a.length;l++){var c=a[l],u=r[a[l]];u!==!0&&void 0!==u&&(i=R(u),t+="\n"+m(1)+"if("+c+" === undefined) {"+c+" = "+i+"}")}return e.children.block&&(t+=" return "+R(e.children.block,r)),O.pop(),t+"; }"},FUNC_DEF:function(e){var n,t,i,a,l,c,u;n="",t=r(),i="dom"===e.children.fd.value,e.children.fn&&(n=e.children.fn.value,t[n]=!0),t=o(),a="function "+n+"(",e.children.params&&(a+=R(e.children.params)),a+=") {";for(var s=Object.keys(t),f=0;f<s.length;f++){var d=s[f],h=t[s[f]];h!==!0&&void 0!==h&&(l=R(h),a+="\n"+m(1)+"if("+d+" === undefined) {"+d+" = "+l+";}")}return c="",e.children.block&&(c=R(e.children.block)),i&&(a+="\n"+m(1)+"var "+A()+" = [];"),u=_(),u&&(a+="\n"+m(1)+u),a+=c,O.pop(),i&&(a+="\n"+m(1)+"return "+A()+";"),a+"\n"+m()+"}"},FUNC_DEF_PARAMS:function(e){var n,t;n="",t=r(),"name"===e.children[0].type&&(t[e.children[0].value]=!0,e.children[1]&&"assign"===e.children[1].type&&(t[e.children[0].value]=e.children[2]));for(var o=Object.keys(e.children),i=0;i<o.length;i++){var a=e.children[o[i]];("name"===a.type||"FUNC_DEF_PARAMS"===a.type||"comma"===a.type||"window"===a.type)&&(n+=R(a))}return n},ASSIGN:function(e){var n,o,i,a,l,c,u,s,f,d;if(n="",o=e.children.op.value,i=":="===o,i&&(o="="),a=r(),l=e.children.left,c=R(e.children.right),"STRICT_COMMA_SEPARATED_EXPR"===l.type){M++,u=""+L+"unpack"+M,n+="var "+u+" = "+c+";\n"+m(),s=0;for(var h=Object.keys(l.children),p=0;p<h.length;p++){var v=l.children[h[p]];f=v.children[0],"name"===f.type&&1===v.children.length&&g(f.value),n+=R(v)+" "+o+" "+u+"["+s+"]",s<l.children.length-1&&(n+=";\n"+m()),s++}return n}return"name"===l.children[0].type&&(d=l.children[0],t(d.value)||i||g(d.value)),R(e.children.left)+" "+o+" "+c},STATEMENT:function(e){var n,r,t,o;n="";for(var i=Object.keys(e.children),a=0;a<i.length;a++){var l=e.children[i[a]];r=l.children&&l.children[0],t=l.type,n+=R(l),o=r&&("FUNC_DEF"===r.type||"LAMBDA"===r.type),"FOR"===t||"TRY_CATCH"===t||"WHILE"===t||"IF"===t||"STATEMENT"===t||"samedent"===t||o||(n+=";")}return n},IF:function(e){var n,r;if(n="",n="if("+R(e.children.e)+") {"+R(e.children.b)+"\n"+m()+"}",r=e.children.elif)if(Array.isArray(r))for(var t=Object.keys(r),o=0;o<t.length;o++){var i=r[t[o]];n+=R(i)}else n+=R(r);return e.children.el&&(n+=R(e.children.el)),n},IF_EXPR:function(e){var n;return n="",n=R(e.children.test)+" ? "+R(e.children.e)+" : ",n+=e.children.el?R(e.children.el):"undefined"},ELSE_EXPR:function(e){return R(e.children.b)},WHILE:function(e){return"while("+R(e.children.e)+"){"+R(e.children.b)+"\n"+m()+"}"},FOR:function(e){var n,r,t,o,i,a;return n=L+"index"+T,r=L+"keys"+T,t=R(e.children.a),o=e.children.v.value,T++,i=!1,e.children.k&&(i=e.children.k.value),a="var "+r+" = Object.keys("+t+");\n",a+=m()+"for(var "+n+" = 0; "+n+" < "+r+".length; "+n+"++) {\n",i&&(a+=m(1)+"var "+i+" = "+r+"["+n+"];\n"),a+=m(1)+"var "+o+" = "+t+"["+r+"["+n+"]];",a+=R(e.children.b)+"\n"+m()+"}"},ELSE_IF:function(e){return" else if("+R(e.children.e)+") {"+R(e.children.b)+"\n"+m()+"}"},ELSE:function(e){return" else {"+R(e.children.b)+"\n"+m()+"}"},TRY_CATCH:function(e){var n;return n="try {",n+=R(e.children.b1),n+="\n"+m()+"} catch("+R(e.children.err)+") {",n+=R(e.children.b2),n+"\n"+m()+"}"},STRICT_COMMA_SEPARATED_EXPR:function(e){var n;n=[];for(var r=Object.keys(e.children),t=0;t<r.length;t++){var o=e.children[r[t]];n.push(R(o))}return"["+n.join(", ")+"]"},string:function(e){var n,r;if(n=e.value,n=n.replace(/\n/g,"\\n"),r=W.parse(n),!r.complete)throw new Error(r.hint);return l(r,n.charAt(0))},comment:function(e){return e.value.replace(/^#/g,"//")},pazz:function(){return""},not:function(){return"!"},and:function(){return"&& "},or:function(){return"|| "},comparison:function(e){return"=="===e.value?"===":"!="===e.value?"!==":e.value}},j=S.compileGrammar(D,N),n.exports={grammar:j,strGrammar:W,grammarDef:D,epegjs:S,tokenDef:N,generateModule:P,generateCode:R,generateExports:b}},{epegjs:2}],2:[function(n,r,t){(function(o){!function(n){if("object"==typeof t&&"undefined"!=typeof r)r.exports=n();else if("function"==typeof e&&e.amd)e([],n);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof o?i=o:"undefined"!=typeof self&&(i=self),i.EPEG=n()}}(function(){return function e(r,t,o){function i(l,c){if(!t[l]){if(!r[l]){var u="function"==typeof n&&n;if(!c&&u)return u(l,!0);if(a)return a(l,!0);var s=new Error("Cannot find module '"+l+"'");throw s.code="MODULE_NOT_FOUND",s}var f=t[l]={exports:{}};r[l][0].call(f.exports,function(e){var n=r[l][1][e];return i(n?n:e)},f,f.exports,e,r,t,o)}return t[l].exports}for(var a="function"==typeof n&&n,l=0;l<o.length;l++)i(o[l]);return i}({1:[function(e,n){"use strict";function r(e,n){for(var r,i,a,l=n.tokenKeys,c=n.tokenMap,u=[],s=e.length,f=e,d=null,h=0,p=0,v=0;s>h;){for(r=null,i=0;i<l.length;i++){a=l[i];var m,A=c[a];if(A.func){if(m=A.func(e,u),void 0!==m){r=m;break}}else{if(!A.reg)throw new Error("Tokenizer error: Invalid token "+a+" without a reg or func property");if(m=e.match(A.reg),null!==m){r=m[0];break}}}if(null===r){if(0===u.length)throw new Error("Tokenizer error: total match failure");d&&(d.pointer+=d.value.length);var y=E(f,u[u.length-1],"Tokenizer error","No matching token found");throw d&&(y+="\nBefore token of type "+d.type+": "+d.value),new Error(y)}d={type:a,value:r,pointer:h,line:p+1,column:v+1},u.push(d);var k=t(r);p+=k,k>0&&(v=0),v+=o(r),h+=r.length,e=e.substr(r.length)}return u.push({type:"EOF",value:""}),u}function t(e){var n=e.split(/\n/g);return n.length-1}function o(e){var n=e.split(/\n/g);return n[n.length-1].length}function i(e,n){var r={type:e.type,value:e.value,repeat:n.repeat,line:e.line,column:e.column};return n.name&&(r.name=n.name),r}function a(e){var n={},r=0;return e.map(function(e){e.name&&("*"==e.repeat||"+"==e.repeat?(n[e.name]||(n[e.name]=[]),n[e.name].push(e)):n[e.name]=e),n["$"+r]=e,r++}),n}function l(e,n,r,t,o){for(var i,a,l=!1,c=e[n.key].hooks[n.index];;){if(i=t,a=f(e,n,r,i),a===!1||a.sp<=o.sp)return l;a.hook=c,o.children=a.children,o.sp=a.sp,o.line=a.line,o.column=a.column,o.start=a.start,o.hooked=a.hooked,o.hook=a.hook,l=a}return l}function c(e,n,r,t){for(var o=n.key+";"+t+";"+n.index,i=_.length-1;i>=0;){if(_[i][0]==o)return!1;i-=1}var a=g[n.key+";"+t];if(void 0!==a)return a;_.push([o,n]);var l=f(e,n,r,t);return _.pop(),l}function u(e,n){return"*"===e.repeat||"?"===e.repeat?!0:"+"===e.repeat&&n.children.length&&n.children[n.children.length-1].type==e.type?!0:!1}function s(e){return"*"===e.repeat||"+"===e.repeat}function f(e,n,r,t){for(var o,a,f=t,d=0,h=n.tokens[d],p=r[f],v={type:n.key,children:[],start:t,name:n.name,line:p.line,column:p.column};h&&p;){if(e[h.type]){var E=e[h.type].rules,m=e[h.type].hooks;a=!1;var A=g[h.type+";"+f];if(A&&(a=A),!a)for(o=0;o<E.length;o++){var y=E[o],k=m[o];if(a=c(e,y,r,f)){if(a.hook=k,g[y.key+";"+f]=a,h.repeat===!1){var _=l(e,n,r,f,a);if(_!==!1)return _}break}}if(a)f=a.sp,v.children.push({type:h.type,children:a.children,sp:a.sp,line:a.line,column:a.column,hook:a.hook,name:h.name,repeat:h.repeat}),s(h)||d++;else{if(!u(h,v))return!1;d++}}else if(p.type===h.type)h.nonCapturing||(v.children.push(i(p,h)),f++),s(h)||d++;else{if(!u(h,v))return!1;d++}if(b===f&&R.candidates.push([n,n.tokens[d]]),f>b&&(R={sp:f,candidates:[[n,n.tokens[d]]]},b=f),h=n.tokens[d],p=r[f],void 0===h)return v.sp=f,v.rp=d,v;if(void 0===p)return u(h,v)?(v.sp=f,v.rp=d,v):!1}return!1}function d(e,n){return e.split(n).map(function(e){return e.trim()})}function h(e){var n="!"===e.charAt(0);n&&(e=e.substr(1));var r=e.charAt(e.length-1);"*"===r||"?"===r||"+"===r?e=e.substr(0,e.length-1):r=!1;var t,o=e.split(":");if(t=2===o.length?{type:o[1],name:o[0]}:{type:e},t.repeat=r,("*"===r||"+"===r)&&n)throw new Error("Impossible to have non capturing token that repeats");return n&&(t.nonCapturing=n),t}function p(e,n){var r,t,o,i,a=Object.keys(e),l={};l.tokenDef=n,l.tokenKeys=[],l.tokenMap={},n.map(function(e){l.tokenMap[e.key]=e,l.tokenKeys.push(e.key)});var c=a.concat(l.tokenKeys);for(r=0;r<a.length;r++){var u=e[a[r]],s=a[r],f=u.rules,p=[],v=[];for(t=0;t<f.length;t++){var E=d(f[t]," ");for(i=0,o=0;o<E.length;o++){var m=E[o]=h(E[o]);if(-1===c.indexOf(m.type)&&"EOF"!==m.type)throw new Error("Invalid token type used in the grammar rule "+s+": "+m.type+", valid tokens are: "+c.join(", "));if("*"===m.repeat&&(i+=1),m.nonCapturing&&E[E.length-1]!=E[o])throw new Error("A non capturing token can only be the last one in the rule: "+m.type)}if(i===E.length)throw new Error("Rule "+f[t]+" only has optional greedy tokens.");if(v.push({key:s,index:t,tokens:E}),"function"==typeof u.hooks)p.push(u.hooks);else if(u.hooks){if(void 0===u.hooks[t])throw new Error("Incorrect number of hooks ar rule "+a[r]);p.push(u.hooks[t])}}l[s]={rules:v,hooks:p||[],verbose:u.verbose}}return l.parse=function(e){return k(e,l)},l}function v(e){for(var n="",r=0;e>r;r++)n+=" ";return n}function E(e,n,r,t){var o,i=n.pointer||0,a=e.split("\n"),l=0,c=0;for(o=0;o<a.length&&(l+=a[o].length+1,!(l>=i));o++)c+=a[o].length+1;var u=Math.max(0,o),s=r+" at line "+(u+1)+" char "+(i-c)+": ",f="\n"+v(i-c+(u+": ").length);return void 0!==a[u-1]&&(s=s+"\n"+u+": "+a[u-1]),s=s+"\n"+(u+1)+": "+a[u]+f,s=s+"^-- "+t,void 0!==a[u+1]&&(s=s+"\n"+(u+2)+": "+a[u+1]),s}function m(e,n){var r=e.tokenMap[n];return r&&r.verbose?r.verbose:e[n]&&e[n].verbose?e[n].verbose:n}function A(e,n,r,t){if(!r||!r.candidates[0])return"Complete failure to parse";var o=r.candidates[0][0],i=[];r.candidates.map(function(e){if(e[1]){var n=m(t,e[1].type);-1===i.indexOf(n)&&i.push(n)}});var a=i.join(" or "),l=E(e,n[r.sp],"Parser error","Rule "+m(t,o.key));l=l+"\nExpect "+a;var c=n[r.sp]||{type:"EOF"};return l=l+"\nBut got "+m(t,c.type)+" instead"}function y(e){if(e.children){for(var n=0;n<e.children.length;n++)y(e.children[n]);e.hook&&(e.children=e.hook(a(e.children)))}}function k(e,n){var t,o,i,a={type:"START",sp:0,complete:!1};for(i=r(e,n),R={sp:0,candidates:[]},b=0,t=0;t<n.START.rules.length;t++)_=[],g={},o=c(n,n.START.rules[t],i,0),o&&o.sp>a.sp&&(a={type:"START",children:o.children,sp:o.sp,complete:o.sp===i.length,inputLength:i.length});return a.bestParse=R,y(a),R&&!a.complete&&(a.hint=A(e,i,R,n)),a}var _=[],g={},R=null,b=0;n.exports={parse:k,stack:_,compileGrammar:p,tokenize:r,memoization:g}},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});